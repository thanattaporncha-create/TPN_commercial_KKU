<!doctype html>
<html lang="th" class="h-full">
<head>
┬а <meta charset="UTF-8">
┬а <meta name="viewport" content="width=device-width, initial-scale=1.0">
┬а <title>TPN System | Srinagarind Hospital</title>
┬а <script src="https://cdn.tailwindcss.com"></script>
┬а <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
┬а <style>
┬а ┬а body { font-family: 'Sarabun', sans-serif; background-color: #f0f4f0; }
┬а ┬а .gradient-header { background: linear-gradient(135deg, #065f46 0%, #10b981 100%); }
┬а ┬а .card-shadow { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05); }
┬а ┬а .section-title { border-left: 5px solid #10b981; padding-left: 12px; font-weight: 800; color: #000000; font-size: 1.1rem; }
┬а ┬а .ward-dropdown { max-height: 250px; overflow-y: auto; z-index: 100; }
┬а ┬а input[type="number"]::-webkit-outer-spin-button, input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
┬а ┬а .route-radio:checked + label { background-color: #065f46; color: white; border-color: #065f46; transform: scale(1.02); }
┬а ┬а .hidden { display: none; }
┬а </style>
</head>
<body class="p-4 md:p-8">

┬а <div id="loginPage" class="min-h-[80vh] flex items-center justify-center">
┬а ┬а <div class="max-w-md w-full bg-white p-10 rounded-3xl shadow-2xl border border-emerald-50 text-center">
┬а ┬а ┬а <div class="inline-block p-4 rounded-2xl bg-emerald-600 text-white mb-4 shadow-lg">
┬а ┬а ┬а ┬а <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
┬а ┬а ┬а ┬а ┬а <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
┬а ┬а ┬а ┬а </svg>
┬а ┬а ┬а </div>
┬а ┬а ┬а <h1 class="text-2xl font-black text-emerald-900 mb-6 uppercase tracking-tighter">TPN LOGIN SYSTEM</h1>
┬а ┬а ┬а <form onsubmit="handleLogin(event)" class="space-y-4">
┬а ┬а ┬а ┬а <input type="text" id="username" placeholder="Username" required class="w-full p-4 border-2 border-emerald-50 rounded-2xl focus:border-emerald-500 outline-none font-bold text-center uppercase tracking-widest text-emerald-700 bg-emerald-50/30">
┬а ┬а ┬а ┬а <input type="password" id="password" placeholder="Password" required class="w-full p-4 border-2 border-emerald-50 rounded-2xl focus:border-emerald-500 outline-none font-bold text-center tracking-widest text-emerald-700 bg-emerald-50/30">
┬а ┬а ┬а ┬а <button type="submit" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white p-5 rounded-2xl font-black text-xl shadow-xl transition-all transform active:scale-95">
┬а ┬а ┬а ┬а ┬а р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ ЁЯЪА
┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а </form>
┬а ┬а </div>
┬а </div>

┬а <div id="mainApp" class="max-w-4xl mx-auto hidden">
┬а ┬а <nav class="flex justify-between items-center mb-4">
┬а ┬а ┬а ┬а <div class="flex items-center gap-2">
┬а ┬а ┬а ┬а ┬а ┬а <span class="text-xs font-bold text-gray-400 uppercase tracking-tighter">р╕Ьр╕╣р╣Йр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б:</span>
┬а ┬а ┬а ┬а ┬а ┬а <span id="displayUserName" class="text-sm font-black text-emerald-700 px-3 py-1 bg-white border border-emerald-100 rounded-xl shadow-sm"></span>
┬а ┬а ┬а ┬а ┬а ┬а <button onclick="logout()" class="text-[10px] font-black text-red-400 hover:text-red-600 uppercase ml-2 underline">Logout</button>
┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а <div class="flex gap-2">
┬а ┬а ┬а ┬а ┬а ┬а <button class="px-4 py-2 bg-white rounded-xl text-emerald-800 font-black text-xs shadow-sm border border-emerald-50 hover:bg-emerald-50">ЁЯУК Dashboard</button>
┬а ┬а ┬а ┬а ┬а ┬а <button class="px-4 py-2 bg-white rounded-xl text-emerald-800 font-black text-xs shadow-sm border border-emerald-50 hover:bg-emerald-50">ЁЯУж Stock</button>
┬а ┬а ┬а ┬а </div>
┬а ┬а </nav>

┬а ┬а <div class="space-y-6">
┬а ┬а ┬а ┬а <header class="gradient-header p-8 rounded-3xl shadow-xl">
┬а ┬а ┬а ┬а ┬а <div class="flex justify-between items-center text-white">
┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <h1 class="text-2xl font-bold uppercase tracking-tight text-white">TPN COMMERCIAL ORDER</h1>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-lg font-medium text-white">р╕гр╕░р╕Ър╕Ър╕Др╕│р╕Щр╕зр╕Ур╕кр╕▓р╕гр╕нр╕▓р╕лр╕▓р╕гр╣Бр╕Ър╕Ър╕кр╕│р╣Ар╕гр╣Зр╕Ир╕гр╕╣р╕Ы</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm uppercase text-white">Srinagarind Hospital</p>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а <button onclick="location.reload()" class="text-xs bg-white/20 px-3 py-1 rounded-lg hover:bg-white/30 transition-all text-white border border-white/20">ЁЯФД р╣Ар╕гр╕┤р╣Ир╕бр╣Гр╕лр╕бр╣И</button>
┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а </header>

┬а ┬а ┬а ┬а <section class="bg-white p-6 rounded-2xl card-shadow space-y-4">
┬а ┬а ┬а ┬а ┬а <h2 class="section-title">ЁЯУЛ р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕▒р╣Ир╕зр╣Др╕Ы</h2>
┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-sm font-bold text-gray-600 mb-1">р╕зр╕▒р╕Щр╕Чр╕╡р╣И Order</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="date" id="orderDate" class="w-full p-2.5 border rounded-xl bg-gray-50 outline-none">
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-sm font-bold text-gray-600 mb-1">HN</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="hn" placeholder="р╕гр╕░р╕Ър╕╕ HN" class="w-full p-2.5 border rounded-xl outline-none">
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-sm font-bold text-gray-600 mb-1">р╕Кр╕╖р╣Ир╕н-р╕Щр╕▓р╕бр╕кр╕Бр╕╕р╕е</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="patientName" placeholder="р╕Кр╕╖р╣Ир╕нр╕Др╕Щр╣Др╕Вр╣Й" class="w-full p-2.5 border rounded-xl outline-none">
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а <div class="relative">
┬а ┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-sm font-bold text-gray-600 mb-1">Ward</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="wardInput" placeholder="р╕Др╣Йр╕Щр╕лр╕▓..." class="w-full p-2.5 border rounded-xl outline-none" onfocus="showWards()" oninput="filterWards()" autocomplete="off">
┬а ┬а ┬а ┬а ┬а ┬а ┬а <div id="wardList" class="hidden absolute left-0 right-0 mt-1 bg-white border border-gray-200 rounded-xl shadow-2xl ward-dropdown"></div>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а <div class="pt-4 border-t border-emerald-50 text-center">
┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-sm font-bold text-gray-400 mb-2 uppercase tracking-widest text-center">Route</label>
┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-2 gap-4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="radio" name="route" id="route-central" value="Central Line" class="hidden route-radio" checked>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="route-central" class="flex items-center justify-center p-3 border-2 border-emerald-50 rounded-xl cursor-pointer font-bold text-emerald-800 transition-all">ЁЯЯг Central</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="radio" name="route" id="route-peripheral" value="Peripheral Line" class="hidden route-radio">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="route-peripheral" class="flex items-center justify-center p-3 border-2 border-emerald-50 rounded-xl cursor-pointer font-bold text-emerald-800 transition-all">ЁЯФ╡ Peripheral</label>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а </section>

┬а ┬а ┬а ┬а <section class="bg-white p-6 rounded-2xl card-shadow">
┬а ┬а ┬а ┬а ┬а <h2 class="section-title mb-4">тЪЦя╕П р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕Др╕Щр╣Др╕Вр╣Й</h2>
┬а ┬а ┬а ┬а ┬а <div class="relative max-w-xs mx-auto md:mx-0">
┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="bw" step="0.1" placeholder="0.0" class="w-full p-4 border-2 border-emerald-100 rounded-2xl pr-16 text-3xl font-black text-emerald-700 outline-none" oninput="calculateAll()">
┬а ┬а ┬а ┬а ┬а ┬а <span class="absolute right-4 top-5 text-emerald-300 font-black text-xl">kg</span>
┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а </section>

┬а ┬а ┬а ┬а <section class="bg-white p-6 rounded-2xl card-shadow space-y-4 border-t-8 border-emerald-600">
┬а ┬а ┬а ┬а ┬а <h2 class="section-title" style="color:#065f46; text-center; text-emerald-800">ЁЯУж р╣Ар╕ер╕╖р╕нр╕Бр╕Ьр╕ер╕┤р╕Хр╕ар╕▒р╕Ур╕Ср╣Мр╣Бр╕ер╕░р╕Ир╕│р╕Щр╕зр╕Щ</h2>
┬а ┬а ┬а ┬а ┬а <select id="productSelect" class="w-full p-4 border-2 border-emerald-100 rounded-xl bg-emerald-50 text-xl font-black text-emerald-900 outline-none text-center" onchange="updateProductDetails()">
┬а ┬а ┬а ┬а ┬а ┬а <option value="">-- р╕Др╕ер╕┤р╕Бр╣Ар╕ер╕╖р╕нр╕Бр╕кр╕▓р╕гр╕нр╕▓р╕лр╕▓р╕г --</option>
┬а ┬а ┬а ┬а ┬а ┬а <option value="smof_c_1477" data-vol="1477" data-kcal="1600">SMOF kabiven (C-line) 1,477 ml / 1600 kcal</option>
┬а ┬а ┬а ┬а ┬а ┬а <option value="smof_c_986" data-vol="986" data-kcal="1100">SMOF kabiven (C-line) 986 ml / 1100 kcal</option>
┬а ┬а ┬а ┬а ┬а ┬а <option value="smof_p_1904" data-vol="1904" data-kcal="1300">SMOF kabiven (P-line) 1,904 ml / 1300 kcal</option>
┬а ┬а ┬а ┬а ┬а ┬а <option value="oli_n7" data-vol="1500" data-kcal="1800">Oliclinomel N/7 (C-line) 1,500 ml / 1800 kcal</option>
┬а ┬а ┬а ┬а ┬а ┬а <option value="oli_n4" data-vol="1500" data-kcal="910">Oliclinomel N/4 (P-line) 1,500 ml / 910 kcal</option>
┬а ┬а ┬а ┬а ┬а ┬а <option value="nutri_p" data-vol="1875" data-kcal="1435">Nutriflex lipid peri 1,875 ml / 1435 kcal</option>
┬а ┬а ┬а ┬а ┬а ┬а <option value="nutri_vr" data-vol="1250" data-kcal="1475">Nutriflex lipid VR 1,250 ml / 1475 kcal</option>
┬а ┬а ┬а ┬а ┬а ┬а <option value="bfluid" data-vol="1000" data-kcal="420">B-Fluid 1,000 ml / 420 kcal</option>
┬а ┬а ┬а ┬а ┬а </select>

┬а ┬а ┬а ┬а ┬а <div class="bg-emerald-50 p-4 rounded-2xl border border-emerald-100 text-center">
┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-xs font-black text-emerald-600 uppercase mb-2 tracking-widest">р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕Зр╕Чр╕╡р╣Ир╣Ар╕Ър╕┤р╕Б (Stock Out)</label>
┬а ┬а ┬а ┬а ┬а ┬а <div class="flex items-center justify-center gap-6">
┬а ┬а ┬а ┬а ┬а ┬а ┬а <button onclick="changeBag(-1)" class="w-12 h-12 bg-white rounded-full shadow-md text-2xl font-black text-emerald-600 border border-emerald-100 active:scale-90">-</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <span id="bagCountDisplay" class="text-4xl font-black text-emerald-900 w-16 text-center">1</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <button onclick="changeBag(1)" class="w-12 h-12 bg-white rounded-full shadow-md text-2xl font-black text-emerald-600 border border-emerald-100 active:scale-90">+</button>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а <input type="hidden" id="bagCount" value="1">
┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-2 gap-4">
┬а ┬а ┬а ┬а ┬а ┬а <div class="p-4 bg-emerald-50 rounded-2xl text-center border border-emerald-100">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="text-xs font-black text-emerald-600 uppercase">Volume:</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-2xl font-black text-emerald-900"><span id="prodVol">0</span> ml</div>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а <div class="p-4 bg-yellow-50 rounded-2xl text-center border border-yellow-100">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="text-xs font-black text-yellow-600 uppercase">Energy:</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-2xl font-black text-yellow-900"><span id="prodKcal">0</span> kcal</div>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а </section>

┬а ┬а ┬а ┬а <section class="bg-white p-8 rounded-2xl card-shadow space-y-6">
┬а ┬а ┬а ┬а ┬а <h2 class="section-title">ЁЯзк ADDITIVES</h2>
┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-1 md:grid-cols-2 gap-8 text-center">
┬а ┬а ┬а ┬а ┬а ┬а <div class="space-y-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-xl font-black text-gray-800 uppercase">Addamel-N (ml)</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="addamel" value="10" class="w-full p-4 border-2 border-gray-100 rounded-2xl text-3xl font-black text-emerald-700 bg-gray-50 outline-none text-center" oninput="calculateAll()">
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а <div class="space-y-3">
┬а ┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-xl font-black text-gray-800 flex justify-between uppercase px-2">Vitamins <span id="vit-max-msg" class="text-xs text-red-500 font-black invisible uppercase tracking-tighter self-center">MAX REACHED</span></label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex gap-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button onclick="selectVitamin('cernevit')" id="btn-cernevit" class="flex-1 py-4 rounded-xl border-2 font-black text-xs uppercase bg-white text-gray-400">Cernevit</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button onclick="selectVitamin('soluvit')" id="btn-soluvit" class="flex-1 py-4 rounded-xl border-2 font-black text-xs uppercase bg-white text-gray-400">Soluvit-N</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="vitVol" class="w-full p-4 border-2 border-gray-100 rounded-2xl text-3xl font-black text-emerald-700 bg-gray-50 outline-none text-center" oninput="calculateAll()">
┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="vit-hint" class="text-[10px] font-bold text-gray-400 uppercase italic"></p>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а <div class="space-y-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-xl font-black text-gray-800 flex justify-between uppercase px-2">B-CO (ml) <span class="text-xs text-red-500 font-black tracking-tighter self-center uppercase">MAX 2 ml</span></label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="bco" value="2" class="w-full p-4 border-2 border-gray-100 rounded-2xl text-3xl font-black text-emerald-700 bg-gray-50 outline-none text-center" oninput="checkBcoLimit()">
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а <div class="space-y-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-xl font-black text-gray-800 uppercase">Vitalipid Adult (ml)</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="vitalipid" value="10" class="w-full p-4 border-2 border-gray-100 rounded-2xl text-3xl font-black text-emerald-700 bg-gray-50 outline-none text-center" oninput="calculateAll()">
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а <div class="space-y-4 pt-8 border-t border-emerald-50 text-left">
┬а ┬а ┬а ┬а ┬а ┬а <span class="text-xl font-black text-gray-800 italic block uppercase tracking-widest mb-4">Add р╕кр╕▓р╕гр╕нр╕╖р╣Ир╕Щр╣Ж</span>
┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="other-additives">
┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex gap-3"><input type="text" id="o1-name" placeholder="р╕Кр╕╖р╣Ир╕нр╕кр╕▓р╕г 1" class="flex-1 p-3 border border-gray-100 rounded-xl font-bold"><input type="number" id="o1-vol" placeholder="ml" class="w-24 p-3 border border-gray-100 rounded-xl text-center font-black text-emerald-700 other-vol" oninput="calculateAll()"></div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex gap-3"><input type="text" id="o2-name" placeholder="р╕Кр╕╖р╣Ир╕нр╕кр╕▓р╕г 2" class="flex-1 p-3 border border-gray-100 rounded-xl font-bold"><input type="number" id="o2-vol" placeholder="ml" class="w-24 p-3 border border-gray-100 rounded-xl text-center font-black text-emerald-700 other-vol" oninput="calculateAll()"></div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex gap-3"><input type="text" id="o3-name" placeholder="р╕Кр╕╖р╣Ир╕нр╕кр╕▓р╕г 3" class="flex-1 p-3 border border-gray-100 rounded-xl font-bold"><input type="number" id="o3-vol" placeholder="ml" class="w-24 p-3 border border-gray-100 rounded-xl text-center font-black text-emerald-700 other-vol" oninput="calculateAll()"></div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex gap-3"><input type="text" id="o4-name" placeholder="р╕Кр╕╖р╣Ир╕нр╕кр╕▓р╕г 4" class="flex-1 p-3 border border-gray-100 rounded-xl font-bold"><input type="number" id="o4-vol" placeholder="ml" class="w-24 p-3 border border-gray-100 rounded-xl text-center font-black text-emerald-700 other-vol" oninput="calculateAll()"></div>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а </section>

┬а ┬а ┬а ┬а <section class="bg-emerald-900 text-white p-8 rounded-3xl shadow-2xl border-b-[12px] border-emerald-700">
┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10 text-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="space-y-1">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="text-emerald-400 font-bold uppercase text-xs tracking-widest">Total Volume (ml)</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-6xl font-black"><span id="totalVolDisplay">0</span> <small class="text-2xl text-emerald-300">ml</small></div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-white/5 p-6 rounded-2xl border border-white/20">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-yellow-400 text-base font-black mb-3 italic tracking-wide" id="rateHint">ЁЯСЙ р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕ер╕╖р╕нр╕Б Product...</div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex items-center gap-4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="manualRate" placeholder="0.0" class="w-full bg-emerald-700 text-white text-4xl font-black p-4 rounded-2xl outline-none text-center placeholder-emerald-800">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="text-2xl font-black">ml/hr</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а <button id="saveBtn" onclick="saveOrder()" class="w-full bg-emerald-500 hover:bg-emerald-400 p-8 rounded-3xl text-3xl font-black shadow-xl transition-all active:scale-95">ЁЯТ╛ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Бр╕ер╕░р╕Юр╕┤р╕бр╕Юр╣Мр╕Йр╕ер╕▓р╕Б</button>
┬а ┬а ┬а ┬а </section>
┬а ┬а ┬а ┬а <p class="text-center text-emerald-800 text-[10px] py-10 uppercase font-black tracking-[0.2em]">Srinagarind Hospital тАв Pharmacy Dept</p>
┬а ┬а </div>
┬а </div>

┬а <script>
┬а ┬а const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzaH4rJ663N7O0NrdqbAMiXqx9HYJAU-AsvXW5B6tB8_w8eZ06ui8GJDzo83e9scvPn/exec";

┬а ┬а const userMap = {
┬а ┬а ┬а 'OP': 'р╕ар╕Н.р╕нр╕гр╕Ыр╕ар╕▓ р╕Кр╕▒р╕вр╣Ар╕ер╕┤р╕ир╕зр╕▓р╕Ур╕┤р╕К', 'SK': 'р╕ар╕Н.р╕ир╕┤р╕гр╕┤р╣Вр╕Кр╕Д р╕Др╕╕р╕Ур╕зр╕Зр╕ир╣Мр╕Бр╕др╕Х', 'NC': 'р╕ар╕Н.р╕Ур╕▒р╕Рр╕зр╕гр╕гр╕У р╕Йр╣Ир╕│р╕бр╕Ур╕╡',
┬а ┬а ┬а 'TT': 'р╕ар╕Н.р╕ир╕┤р╕гр╕┤р╕гр╕▒р╕Хр╕Щр╣М р╕нр╕┤р╣Ир╕бр╣Ар╕нр╕бр╕Бр╕бр╕е', 'MP': 'р╕ар╕Н.р╕лр╕Щр╕╢р╣Ир╕Зр╕др╕Чр╕▒р╕в р╕Юр╕гр╕лр╕бр╕лр╕▓р╕гр╕▓р╕К', 'PC': 'р╕ар╕Н.р╕Юр╕┤р╕Кр╕Нр╕▓р╕Щр╕┤р╕е р╕Кр╕▓р╕Шр╕гр╕гр╕бр╕▓',
┬а ┬а ┬а 'CK': 'р╕ар╕Н.р╕Кр╕Щр╕бр╣Мр╕Щр╕┤р╕ар╕▓ р╕Бр╕▒р╕Щр╕лр╕▓р╕Бр╕╕р╕е', 'KM': 'р╕ар╕Н.р╕Шр╕Ур╕▒р╕Рр╕ар╕гр╕Ур╣М р╣Ар╕Ир╕гр╕┤р╕Нр╕Бр╕┤р╕Ир╕Хр╕гр╕░р╕Бр╕╣р╕е', 'ST': 'р╕ар╕Н.р╕кр╕╕р╕зр╕┤р╕бр╕е р╕Шр╕гр╕гр╕бр╕Бр╕╕р╕е',┬а
┬а ┬а ┬а 'LS': 'р╕ар╕Н.р╕ер╕▒р╕Бр╕йр╕┤р╕Бр╕▓ р╕Ир╕┤р╕Хр╕гр╕Кр╕╖р╣Ир╕Щ', 'SO': 'р╕ар╕Н.р╕нр╕┤р╕кр╕гр╕▓ р╣Вр╕кр╕ар╕▒р╕в'
┬а ┬а };

┬а ┬а function handleLogin(e) {
┬а ┬а ┬а if (e) e.preventDefault();
┬а ┬а ┬а const u = document.getElementById('username').value.trim().toUpperCase();
┬а ┬а ┬а const p = document.getElementById('password').value.trim().toUpperCase();
┬а ┬а ┬а if (u === p && userMap[u]) {
┬а ┬а ┬а ┬а sessionStorage.setItem('tpnUser', userMap[u]);
┬а ┬а ┬а ┬а showMainApp();
┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а alert('тЭМ р╕гр╕лр╕▒р╕кр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╕Щр╕░р╕Др╕░ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕гр╕лр╕▒р╕к ' + u + ' р╕нр╕╡р╕Бр╕Др╕гр╕▒р╣Йр╕Зр╕Др╣Ир╕░');
┬а ┬а ┬а }
┬а ┬а }

┬а ┬а function showMainApp() {
┬а ┬а ┬а document.getElementById('loginPage').classList.add('hidden');
┬а ┬а ┬а document.getElementById('mainApp').classList.remove('hidden');
┬а ┬а ┬а document.getElementById('displayUserName').textContent = sessionStorage.getItem('tpnUser');
┬а ┬а ┬а document.getElementById('orderDate').valueAsDate = new Date();
┬а ┬а ┬а calculateAll();
┬а ┬а }

┬а ┬а function logout() { sessionStorage.clear(); location.reload(); }

┬а ┬а function changeBag(val) {
┬а ┬а ┬а const display = document.getElementById('bagCountDisplay');
┬а ┬а ┬а const hiddenInput = document.getElementById('bagCount');
┬а ┬а ┬а let current = parseInt(hiddenInput.value);
┬а ┬а ┬а let newValue = current + val;
┬а ┬а ┬а if (newValue < 1) newValue = 1;
┬а ┬а ┬а hiddenInput.value = newValue;
┬а ┬а ┬а display.textContent = newValue;
┬а ┬а }

┬а ┬а // р╣Бр╕Бр╣Йр╣Др╕В Syntax р╕Хр╕гр╕Зр╕Щр╕╡р╣Йр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕зр╕Др╣Ир╕░
┬а ┬а const wards = ["2р╕Д", "2р╕З", "3р╕Б", "3р╕Д", "3р╕З", "3р╕Й", "4р╕Б", "4р╕Д", "5р╕В", "6р╕Б", "6р╕В",┬а
┬а ┬а ┬а "AE1", "AE2", "AE3", "CCU", "CVT-ICU", "HOME PN", "IMC2р╕З", "IMC3р╕В", "IMC4р╕В",┬а
┬а ┬а ┬а "MICU 1", "MICU 2", "NICU", "PICU", "PICU р╕ир╕кр╕Б.", "SCTU", "SICU 1", "SICU 2",┬а
┬а ┬а ┬а "р╕Бр╕з.6/1", "р╕Бр╕з.6/2", "р╕Бр╕з.7/1", "р╕Бр╕з.7/2", "р╕кр╕з.1/11", "р╕кр╕з.1/12", "р╕кр╕з.1/13",┬а
┬а ┬а ┬а "р╕кр╕з.1/14", "р╕кр╕з.1/15", "р╕кр╕з.1/8B", "р╕кр╕з.1/8C", "р╕кр╕з.1/9A", "р╕кр╕з.1/9B", "р╕кр╕з.1/9C"];

┬а ┬а function showWards() { document.getElementById('wardList').classList.remove('hidden'); renderWards(wards); }
┬а ┬а function renderWards(items) { document.getElementById('wardList').innerHTML = items.map(w => `<div class="p-4 hover:bg-emerald-50 cursor-pointer border-b font-black text-gray-700 text-center" onclick="selectWard('${w}')">${w}</div>`).join(''); }
┬а ┬а function filterWards() { const val = document.getElementById('wardInput').value.toLowerCase(); renderWards(wards.filter(w => w.toLowerCase().includes(val))); }
┬а ┬а function selectWard(w) { document.getElementById('wardInput').value = w; document.getElementById('wardList').classList.add('hidden'); }
┬а ┬а┬а
┬а ┬а let currentVitType = '';
┬а ┬а function selectVitamin(type) {
┬а ┬а ┬а const vitVol = document.getElementById('vitVol');
┬а ┬а ┬а const vitalipid = document.getElementById('vitalipid');
┬а ┬а ┬а const vitHint = document.getElementById('vit-hint');
┬а ┬а ┬а currentVitType = type;
┬а ┬а ┬а document.getElementById('btn-cernevit').className = "flex-1 py-4 rounded-xl border-2 font-black text-xs uppercase bg-white text-gray-400";
┬а ┬а ┬а document.getElementById('btn-soluvit').className = "flex-1 py-4 rounded-xl border-2 font-black text-xs uppercase bg-white text-gray-400";
┬а ┬а ┬а if (type === 'cernevit') {
┬а ┬а ┬а ┬а document.getElementById('btn-cernevit').className = "flex-1 py-4 rounded-xl border-2 font-black text-xs uppercase bg-emerald-600 text-white shadow-md";
┬а ┬а ┬а ┬а vitVol.value = 5; vitHint.innerHTML = "тЪая╕П MAX CERNEVIT = 5 ML";
┬а ┬а ┬а ┬а vitalipid.value = 0; vitalipid.readOnly = true; vitalipid.classList.add('opacity-30', 'bg-gray-200');
┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а document.getElementById('btn-soluvit').className = "flex-1 py-4 rounded-xl border-2 font-black text-xs uppercase bg-yellow-400 text-black shadow-md";
┬а ┬а ┬а ┬а vitVol.value = 10; vitHint.innerHTML = "тЪая╕П MAX SOLUVIT-N = 10 ML";
┬а ┬а ┬а ┬а vitalipid.value = 10; vitalipid.readOnly = false; vitalipid.classList.remove('opacity-30', 'bg-gray-200');
┬а ┬а ┬а }
┬а ┬а ┬а calculateAll();
┬а ┬а }

┬а ┬а function checkBcoLimit() {
┬а ┬а ┬а const bco = document.getElementById('bco');
┬а ┬а ┬а if (parseFloat(bco.value) > 2) bco.classList.add('text-red-700', 'bg-red-50');
┬а ┬а ┬а else bco.classList.remove('text-red-700', 'bg-red-50');
┬а ┬а ┬а calculateAll();
┬а ┬а }

┬а ┬а function updateProductDetails() {
┬а ┬а ┬а const s = document.getElementById('productSelect');
┬а ┬а ┬а const o = s.options[s.selectedIndex];
┬а ┬а ┬а document.getElementById('prodVol').textContent = o.getAttribute('data-vol') || 0;
┬а ┬а ┬а document.getElementById('prodKcal').textContent = o.getAttribute('data-kcal') || 0;
┬а ┬а ┬а calculateAll();
┬а ┬а }

┬а ┬а function calculateAll() {
┬а ┬а ┬а const v = (id) => parseFloat(document.getElementById(id).value) || 0;
┬а ┬а ┬а const prodVol = parseFloat(document.getElementById('prodVol').textContent) || 0;
┬а ┬а ┬а const vitVol = v('vitVol');
┬а ┬а ┬а const vitMaxMsg = document.getElementById('vit-max-msg');
┬а ┬а ┬а if ((currentVitType==='cernevit' && vitVol>5) || (currentVitType==='soluvit' && vitVol>10)) vitMaxMsg.classList.remove('invisible');
┬а ┬а ┬а else vitMaxMsg.classList.add('invisible');
┬а ┬а ┬а let otherTotal = 0;
┬а ┬а ┬а document.querySelectorAll('.other-vol').forEach(input => { otherTotal += parseFloat(input.value) || 0; });
┬а ┬а ┬а const grandTotal = prodVol + v('addamel') + vitVol + v('bco') + v('vitalipid') + otherTotal;
┬а ┬а ┬а document.getElementById('totalVolDisplay').textContent = grandTotal.toLocaleString();
┬а ┬а ┬а const rh = document.getElementById('rateHint');
┬а ┬а ┬а if (grandTotal > 0) { rh.textContent = `тЬЕ р╣Бр╕Щр╕░р╕Щр╕│: ${(grandTotal/24).toFixed(1)} ml/hr`; rh.style.color = "#bef264"; }
┬а ┬а ┬а else { rh.textContent = `ЁЯСЙ р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕ер╕╖р╕нр╕Б Product...`; rh.style.color = "#facc15"; }
┬а ┬а }

┬а ┬а async function saveOrder() {
┬а ┬а ┬а const saveBtn = document.getElementById('saveBtn');
┬а ┬а ┬а const hn = document.getElementById('hn').value;
┬а ┬а ┬а const pName = document.getElementById('patientName').value;
┬а ┬а ┬а if (!hn || !pName) { alert("тЪая╕П р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕░р╕Ър╕╕ HN р╣Бр╕ер╕░р╕Кр╕╖р╣Ир╕нр╕Др╕Щр╣Др╕Вр╣Йр╕Др╣Ир╕░"); return; }
┬а ┬а ┬а┬а
┬а ┬а ┬а const productSelect = document.getElementById('productSelect');
┬а ┬а ┬а if (productSelect.value === "") { alert("тЪая╕П р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕ер╕╖р╕нр╕Бр╕Ьр╕ер╕┤р╕Хр╕ар╕▒р╕Ур╕Ср╣Мр╕Др╣Ир╕░"); return; }

┬а ┬а ┬а const v = (id) => document.getElementById(id).value;
┬а ┬а ┬а const t = (id) => document.getElementById(id).textContent;
┬а ┬а ┬а┬а
┬а ┬а ┬а const formData = new URLSearchParams();
┬а ┬а ┬а formData.append("action", "saveOrder");
┬а ┬а ┬а formData.append("orderDate", v('orderDate'));
┬а ┬а ┬а formData.append("hn", hn);
┬а ┬а ┬а formData.append("patientName", pName);
┬а ┬а ┬а formData.append("ward", v('wardInput'));
┬а ┬а ┬а formData.append("route", document.querySelector('input[name="route"]:checked').value);
┬а ┬а ┬а formData.append("bw", v('bw'));
┬а ┬а ┬а formData.append("productName", productSelect.options[productSelect.selectedIndex].text);
┬а ┬а ┬а formData.append("productVol", t('prodVol'));
┬а ┬а ┬а formData.append("productKcal", t('prodKcal'));
┬а ┬а ┬а formData.append("quantity", v('bagCount'));
┬а ┬а ┬а formData.append("addamel", v('addamel'));
┬а ┬а ┬а formData.append("vitType", currentVitType);
┬а ┬а ┬а formData.append("vitVol", v('vitVol'));
┬а ┬а ┬а formData.append("bco", v('bco'));
┬а ┬а ┬а formData.append("vitalipid", v('vitalipid'));
┬а ┬а ┬а formData.append("other1Name", v('o1-name'));
┬а ┬а ┬а formData.append("other1Vol", v('o1-vol'));
┬а ┬а ┬а formData.append("other2Name", v('o2-name'));
┬а ┬а ┬а formData.append("other2Vol", v('o2-vol'));
┬а ┬а ┬а formData.append("other3Name", v('o3-name'));
┬а ┬а ┬а formData.append("other3Vol", v('o3-vol'));
┬а ┬а ┬а formData.append("other4Name", v('o4-name'));
┬а ┬а ┬а formData.append("other4Vol", v('o4-vol'));
┬а ┬а ┬а formData.append("totalVol", t('totalVolDisplay'));
┬а ┬а ┬а formData.append("rate", v('manualRate') || (parseFloat(t('totalVolDisplay').replace(/,/g,''))/24).toFixed(1));
┬а ┬а ┬а formData.append("recordedBy", sessionStorage.getItem('tpnUser'));

┬а ┬а ┬а saveBtn.disabled = true;
┬а ┬а ┬а saveBtn.innerHTML = "тП│ р╕Бр╕│р╕ер╕▒р╕Зр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б...";

┬а ┬а ┬а try {
┬а ┬а ┬а ┬а await fetch(SCRIPT_URL, {
┬а ┬а ┬а ┬а ┬а method: 'POST',
┬а ┬а ┬а ┬а ┬а mode: 'no-cors',┬а
┬а ┬а ┬а ┬а ┬а body: formData
┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а const params = formData.toString();
┬а ┬а ┬а ┬а window.open(`label.html?${params}`, '_blank');
┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а alert("тЬЕ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕зр╕Др╣Ир╕░!");
┬а ┬а ┬а ┬а location.reload();┬а
┬а ┬а ┬а } catch (e) {
┬а ┬а ┬а ┬а alert("тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф: " + e.message);
┬а ┬а ┬а ┬а saveBtn.disabled = false;
┬а ┬а ┬а ┬а saveBtn.innerHTML = "ЁЯТ╛ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Бр╕ер╕░р╕Юр╕┤р╕бр╕Юр╣Мр╕Йр╕ер╕▓р╕Б";
┬а ┬а ┬а }
┬а ┬а }

┬а ┬а window.onload = () => { if (sessionStorage.getItem('tpnUser')) showMainApp(); };
┬а </script>
</body>
</html>

<!doctype html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>TPN Label Printing | Srinagarind Hospital</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Sarabun', sans-serif; color: #000; line-height: 1.1; font-weight: 700; }
    
    @media print {
      @page { margin: 0; size: auto; }
      body { background: #fff; margin: 0; padding: 0; }
      .no-print { display: none !important; }
      .sticker { box-shadow: none !important; border: 1px solid #000 !important; margin: 0 auto !important; page-break-after: always; }
      #pn-sticker { zoom: 0.92; } /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏â‡∏•‡∏≤‡∏Å‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö */
    }

    /* ‡∏â‡∏•‡∏≤‡∏Å PN Big Label (8.5 x 12.9 cm) */
    .sticker-pn { 
      width: 8.5cm; 
      height: 12.9cm; 
      padding: 1.45cm 0.4cm 0.4cm 0.4cm; 
      box-sizing: border-box; 
      background: white; 
      border: 1px solid #000; 
      margin: 10px auto; 
      display: flex; 
      flex-direction: column; 
    }

    /* ‡∏â‡∏•‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡∏∏‡∏á (3.5 x 2.48 in) */
    .sticker-bag { 
      width: 3.5in; 
      height: 2.48in; 
      padding: 1.1cm 0.25in 0.1in 0.25in; 
      box-sizing: border-box; 
      background: white; 
      border: 1px solid #000; 
      margin: 10px auto; 
    }

    .pn-table { width: 100%; font-size: 13px; border-collapse: collapse; border: 1.5px solid #000; flex-grow: 1; }
    .pn-table td { border: 1px solid #000; padding: 4px 6px; vertical-align: middle; } 
    .pn-table th { border: 1.5px solid #000; padding: 4px 5px; font-size: 12px; font-weight: 800; background: #f2f2f2; }

    .header-info { font-size: 14px; font-weight: 800; border-bottom: 2px solid #000; margin-bottom: 4px; padding-bottom: 2px; }
    .footer-container { display: flex; justify-content: space-between; align-items: flex-end; width: 100%; margin-top: 8px; border-top: 1.5px solid #000; padding-top: 6px; }
    .rate-box { border: 2px solid #000; padding: 3px 8px; font-size: 16px; font-weight: 900; }
    .exp-text { font-size: 11px; text-align: right; font-weight: 800; }
  </style>
</head>
<body class="bg-slate-100 min-h-screen">

  <div class="max-w-xl mx-auto py-8 no-print text-center">
    <h1 class="text-2xl font-black text-emerald-900 mb-4">üñ®Ô∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏â‡∏•‡∏≤‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå</h1>
    <button onclick="window.print()" class="bg-emerald-600 text-white py-4 px-10 rounded-2xl font-black text-xl shadow-xl hover:bg-emerald-700 transition-all transform active:scale-95">
      ‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏â‡∏•‡∏≤‡∏Å (Print All)
    </button>
    <p class="text-xs text-gray-500 mt-4 uppercase">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏î‡∏∂‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏Ñ‡πà‡∏∞</p>
  </div>

  <div id="print-content">
    <div id="pn-sticker-container"></div>
    <div id="bag-sticker-container"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const data = Object.fromEntries(params.entries());
      
      if (!data.hn) {
        alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡πà‡∏∞");
        return;
      }

      renderLabels(data);
    });

    function formatThaiDate(dateStr) {
      if (!dateStr) return "-";
      const d = new Date(dateStr);
      const months = ["‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.", "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."];
      return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear() + 543}`;
    }

    function renderLabels(o) {
      const expDate = new Date(o.orderDate);
      expDate.setDate(expDate.getDate() + 1);

      // --- 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏â‡∏•‡∏≤‡∏Å PN Big Label ‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ñ‡∏∏‡∏á (Quantity) ---
      const qty = parseInt(o.quantity) || 1;
      let pnHTML = '';
      for (let i = 1; i <= qty; i++) {
        pnHTML += `
          <div class="sticker sticker-pn" id="pn-sticker">
            <div class="header-info flex justify-between">
              <span>HN: ${o.hn} - ${o.patientName}</span>
              <span>‡∏ñ‡∏∏‡∏á‡∏ó‡∏µ‡πà: ${i}/${qty}</span>
            </div>
            <div class="flex justify-between text-sm mb-2">
              <span>Ward: ${o.ward}</span>
              <span>Route: ${o.route}</span>
            </div>
            <table class="pn-table">
              <thead>
                <tr><th style="text-align:left;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</th><th style="width:25%;">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£ (ml)</th></tr>
              </thead>
              <tbody>
                <tr><td>1. ${o.productName}</td><td class="text-right">${o.productVol}</td></tr>
                <tr><td>2. Addamel-N</td><td class="text-right">${o.addamel}</td></tr>
                <tr><td>3. Vitamins (${o.vitType})</td><td class="text-right">${o.vitVol}</td></tr>
                <tr><td>4. B-Complex (B-CO)</td><td class="text-right">${o.bco}</td></tr>
                <tr><td>5. Vitalipid Adult</td><td class="text-right">${o.vitalipid}</td></tr>
                ${o.other1Name ? `<tr><td>6. ${o.other1Name}</td><td class="text-right">${o.other1Vol}</td></tr>` : ''}
                ${o.other2Name ? `<tr><td>7. ${o.other2Name}</td><td class="text-right">${o.other2Vol}</td></tr>` : ''}
                ${o.other3Name ? `<tr><td>8. ${o.other3Name}</td><td class="text-right">${o.other3Vol}</td></tr>` : ''}
                ${o.other4Name ? `<tr><td>9. ${o.other4Name}</td><td class="text-right">${o.other4Vol}</td></tr>` : ''}
                <tr style="background:#f9f9f9; font-weight:800;">
                  <td class="text-right">Total Volume</td>
                  <td class="text-right">${o.totalVol}</td>
                </tr>
              </tbody>
            </table>
            <div class="footer-container">
              <div class="text-[12px]">
                <div>BW: ${o.bw} kg</div>
                <div>Energy: ${o.productKcal} kcal</div>
                <div class="mt-1">Prepared: ${formatThaiDate(o.orderDate)}</div>
              </div>
              <div class="flex flex-col align-end">
                <div class="rate-box mb-1">Rate: ${o.rate} ml/hr</div>
                <div class="exp-text uppercase">EXP: ${formatThaiDate(expDate)}<br>18.00 ‡∏ô.</div>
              </div>
            </div>
            <div class="text-[10px] mt-2 text-right italic">‡πÇ‡∏î‡∏¢: ${o.recordedBy}</div>
          </div>
        `;
      }
      document.getElementById('pn-sticker-container').innerHTML = pnHTML;

      // --- 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏â‡∏•‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡∏∏‡∏á (‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏ó‡πà‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°) ---
      document.getElementById('bag-sticker-container').innerHTML = `
        <div class="sticker sticker-bag flex flex-col items-center justify-center text-center">
          <div style="font-size: 42px; font-weight: 900; line-height: 1;">${o.ward}</div>
          <div style="border-top: 3.5px solid #000; border-bottom: 3.5px solid #000; width: 100%; padding: 6px 0; margin: 6px 0;">
            <span style="font-size: 20px; font-weight: 900; display: block; line-height: 1.1;">${o.patientName}</span>
          </div>
          <div style="font-size: 18px; font-weight: 800; margin-bottom: 2px;">HN: ${o.hn}</div>
          <div style="font-size: 14px; font-weight: 700;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°: ${formatThaiDate(o.orderDate)}</div>
          <div style="font-size: 14px; font-weight: 800; color: #000; margin-top: 4px;">(‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡∏ï‡∏π‡πâ‡πÄ‡∏¢‡πá‡∏ô 2-8¬∞ C)</div>
        </div>
      `;
    }
  </script>
</body>
</html>

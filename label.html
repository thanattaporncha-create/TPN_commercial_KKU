<!doctype html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>TPN Print | Srinagarind Hospital</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Sarabun', sans-serif; color: #000; line-height: 1.2; }
    @media print {
      @page { margin: 0; size: auto; }
      body { background: #fff; margin: 0; padding: 0; }
      .no-print { display: none !important; }
      .sticker { box-shadow: none !important; border: 1px solid #000 !important; margin: 0 auto !important; page-break-after: always; }
      #pn-sticker { zoom: 0.95; }
    }
    /* PN Big Label (8.5 x 12.9 cm) */
    .sticker-pn { 
      width: 8.5cm; height: 12.9cm; 
      padding: 1.4cm 0.5cm 0.5cm 0.5cm; 
      box-sizing: border-box; background: white; 
      border: 1px solid #000; margin: 10px auto; 
      display: flex; flex-direction: column; 
    }
    /* ‡∏â‡∏•‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡∏∏‡∏á (3.5 x 2.48 in) */
    .sticker-bag { 
      width: 3.5in; height: 2.48in; 
      padding: 1.2cm 0.3in 0.1in 0.3in; 
      box-sizing: border-box; background: white; 
      border: 1px solid #000; margin: 10px auto; 
    }
    .pn-table { width: 100%; font-size: 15px; border-collapse: collapse; border: 2px solid #000; flex-grow: 1; }
    .pn-table td { border: 1px solid #000; padding: 5px 8px; font-weight: 700; } 
    .pn-table th { border: 2px solid #000; padding: 5px; font-size: 14px; font-weight: 800; background: #eee; }
    .header-info { font-size: 16px; font-weight: 800; border-bottom: 2px solid #000; margin-bottom: 5px; }
    .footer-container { display: flex; justify-content: space-between; align-items: flex-end; border-top: 2px solid #000; padding-top: 8px; margin-top: 5px; }
    .rate-box { border: 3px solid #000; padding: 4px 10px; font-size: 20px; font-weight: 900; background: #fff; }
  </style>
</head>
<body class="bg-slate-100 p-4">

  <div class="max-w-xl mx-auto no-print text-center mb-6">
    <button onclick="window.print()" class="bg-blue-600 text-white py-4 px-12 rounded-2xl font-black text-2xl shadow-xl active:scale-95">üñ®Ô∏è ‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏â‡∏•‡∏≤‡∏Å</button>
  </div>

  <div id="labels-container"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const o = Object.fromEntries(params.entries());
      if (o.hn) render(o);
    });

    function formatThaiDate(dStr) {
      if (!dStr) return "-";
      const d = new Date(dStr);
      const m = ["‡∏°.‡∏Ñ.","‡∏Å.‡∏û.","‡∏°‡∏µ.‡∏Ñ.","‡πÄ‡∏°.‡∏¢.","‡∏û.‡∏Ñ.","‡∏°‡∏¥.‡∏¢.","‡∏Å.‡∏Ñ.","‡∏™.‡∏Ñ.","‡∏Å.‡∏¢.","‡∏ï.‡∏Ñ.","‡∏û.‡∏¢.","‡∏ò.‡∏Ñ."];
      return `${d.getDate()} ${m[d.getMonth()]} ${d.getFullYear()+543}`;
    }

    function render(o) {
      const exp = new Date(o.orderDate); exp.setDate(exp.getDate() + 1);
      const qty = parseInt(o.quantity) || 1;
      let html = '';

      for(let i=1; i<=qty; i++) {
        html += `
          <div class="sticker sticker-pn" id="pn-sticker">
            <div class="header-info flex justify-between">
              <span>HN: ${o.hn} - ${o.patientName}</span>
              <span>${i}/${qty}</span>
            </div>
            <div class="flex justify-between text-[15px] font-extrabold mb-1">
              <span>Ward: ${o.ward}</span>
              <span>Route: ${o.route}</span>
            </div>
            <table class="pn-table">
              <thead><tr><th align="left">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</th><th width="30%">ml</th></tr></thead>
              <tbody>
                <tr><td>1. ${o.productName}</td><td align="right">${o.productVol}</td></tr>
                <tr><td>2. Addamel-N</td><td align="right">${o.addamel}</td></tr>
                <tr><td>3. Vitamins (${o.vitType})</td><td align="right">${o.vitVol}</td></tr>
                <tr><td>4. B-Complex (B-CO)</td><td align="right">${o.bco}</td></tr>
                <tr><td>5. Vitalipid Adult</td><td align="right">${o.vitalipid}</td></tr>
                ${o.other1Name ? `<tr><td>6. ${o.other1Name}</td><td align="right">${o.other1Vol}</td></tr>` : ''}
                ${o.other2Name ? `<tr><td>7. ${o.other2Name}</td><td align="right">${o.other2Vol}</td></tr>` : ''}
                ${o.other3Name ? `<tr><td>8. ${o.other3Name}</td><td align="right">${o.other3Vol}</td></tr>` : ''}
                ${o.other4Name ? `<tr><td>9. ${o.other4Name}</td><td align="right">${o.other4Vol}</td></tr>` : ''}
                <tr style="background:#eee;"><td align="right">Total Volume</td><td align="right">${o.totalVol}</td></tr>
              </tbody>
            </table>
            <div class="footer-container">
              <div class="text-[14px] font-bold">
                <div>BW: ${o.bw} kg | Cal: ${o.productKcal}</div>
                <div>Prep: ${formatThaiDate(o.orderDate)}</div>
                <div class="text-[11px] italic mt-2">By: ${o.recordedBy}</div>
              </div>
              <div class="text-right">
                <div class="rate-box inline-block mb-1">Rate: ${o.rate} ml/hr</div>
                <div class="text-[13px] font-black uppercase">EXP: ${formatThaiDate(exp)} 18:00</div>
              </div>
            </div>
          </div>
        `;
      }

      html += `
        <div class="sticker sticker-bag flex flex-col items-center justify-center text-center">
          <div style="font-size: 52px; font-weight: 900;">${o.ward}</div>
          <div style="border-top: 4px solid #000; border-bottom: 4px solid #000; width: 100%; padding: 5px 0; margin: 5px 0;">
            <span style="font-size: 24px; font-weight: 900;">${o.patientName}</span>
          </div>
          <div style="font-size: 20px; font-weight: 800;">HN: ${o.hn}</div>
          <div style="font-size: 15px; font-weight: 800; margin-top: 5px;">‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°: ${formatThaiDate(o.orderDate)} (‡πÄ‡∏Å‡πá‡∏ö 2-8¬∞ C)</div>
        </div>
      `;
      document.getElementById('labels-container').innerHTML = html;
    }
  </script>
</body>
</html>

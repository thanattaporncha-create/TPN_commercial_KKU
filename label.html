<!doctype html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>TPN Master Print | Srinagarind Hospital</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Sarabun', sans-serif; color: #000; line-height: 1.2; font-weight: 700; }
    
    @media print {
      @page { margin: 0; size: auto; }
      body { background: #fff; margin: 0; padding: 0; }
      .no-print { display: none !important; }
      /* ‡πÄ‡∏≠‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡∏ô‡∏≠‡∏Å‡∏≠‡∏≠‡∏Å (border: none) ‡πÅ‡∏•‡∏∞‡∏Ç‡∏¢‡∏±‡∏ö‡∏•‡∏á 3mm */
      .sticker { 
        box-shadow: none !important; 
        border: none !important; 
        margin: 3mm auto 0 auto !important; 
        page-break-after: always; 
      }
    }

    /* ‡∏â‡∏•‡∏≤‡∏Å PN Big Label - ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô 7% */
    .sticker-pn { 
      width: 9.1cm; /* ‡πÄ‡∏î‡∏¥‡∏° 8.5cm * 1.07 */
      height: 12.9cm; 
      padding: 1.45cm 0.2cm 0.4cm 0.2cm; 
      box-sizing: border-box; 
      background: white; 
      position: relative;
      display: flex; 
      flex-direction: column; 
    }

    /* ‡∏â‡∏•‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡∏∏‡∏á - ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô 7% ‡πÅ‡∏•‡∏∞‡∏Ç‡∏¢‡∏±‡∏ö‡∏•‡∏á 3mm */
    .sticker-bag { 
      width: 3.75in; /* ‡πÄ‡∏î‡∏¥‡∏° 3.5in * 1.07 */
      height: 2.48in; 
      padding: 1.1cm 0.2in 0.1in 0.2in; 
      box-sizing: border-box; 
      background: white; 
      margin: 3mm auto 0 auto !important;
    }

    .pn-table { width: 100%; font-size: 15px; border-collapse: collapse; border: 2px solid #000; flex-grow: 1; }
    .pn-table td { border: 1px solid #000; padding: 5px 8px; vertical-align: middle; } 
    .pn-table th { border: 2px solid #000; padding: 5px; font-size: 14px; font-weight: 800; background: #eee; }

    .header-info { font-size: 16px; font-weight: 800; border-bottom: 2.5px solid #000; margin-bottom: 5px; padding-bottom: 2px; }
    .footer-container { display: flex; justify-content: space-between; align-items: flex-end; width: 100%; margin-top: 8px; border-top: 2px solid #000; padding-top: 8px; }
    .rate-box { border: 3px solid #000; padding: 4px 10px; font-size: 20px; font-weight: 900; }
    .exp-text { font-size: 12px; text-align: right; font-weight: 800; }
  </style>
</head>
<body class="bg-slate-100 min-h-screen">

  <div class="max-w-xl mx-auto py-8 no-print text-center">
    <h1 class="text-2xl font-black text-emerald-900 mb-4">üñ®Ô∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏â‡∏•‡∏≤‡∏Å (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏ú‡πà‡∏ô)</h1>
    <button onclick="window.print()" class="bg-emerald-600 text-white py-4 px-12 rounded-2xl font-black text-2xl shadow-xl hover:bg-emerald-700 transition-all active:scale-95">
      ‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏â‡∏•‡∏≤‡∏Å
    </button>
  </div>

  <div id="print-content">
    <div id="pn-sticker-container"></div>
    <div id="bag-sticker-container"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const data = Object.fromEntries(params.entries());
      if (data.hn) renderLabels(data);
    });

    function formatThaiDate(dateStr) {
      if (!dateStr) return "-";
      const d = new Date(dateStr);
      const months = ["‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.", "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."];
      return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear() + 543}`;
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤ 0 ‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏á ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏ñ‡∏ß
    function createRow(label, value) {
      const val = parseFloat(value);
      if (!value || isNaN(val) || val === 0) return '';
      return `<tr><td>${label}</td><td class="text-right">${value}</td></tr>`;
    }

    function renderLabels(o) {
      const expDate = new Date(o.orderDate);
      expDate.setDate(expDate.getDate() + 1);

      const qty = parseInt(o.quantity) || 1;
      let pnHTML = '';
      for (let i = 1; i <= qty; i++) {
        pnHTML += `
          <div class="sticker sticker-pn">
            <div class="header-info flex justify-between">
              <span>HN: ${o.hn} - ${o.patientName}</span>
              <span>‡∏ñ‡∏∏‡∏á‡∏ó‡∏µ‡πà: ${i}/${qty}</span>
            </div>
            <div class="flex justify-between text-[15px] font-bold mb-2">
              <span>Ward: ${o.ward}</span>
              <span>Route: ${o.route}</span>
            </div>
            <table class="pn-table">
              <thead>
                <tr><th style="text-align:left;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</th><th style="width:25%;">ml</th></tr>
              </thead>
              <tbody>
                ${createRow(`1. ${o.productName}`, o.productVol)}
                ${createRow('2. Addamel-N', o.addamel)}
                ${createRow(`3. Vitamins (${o.vitType})`, o.vitVol)}
                ${createRow('4. B-Complex (B-CO)', o.bco)}
                ${createRow('5. Vitalipid Adult', o.vitalipid)}
                ${createRow(`6. ${o.other1Name}`, o.other1Vol)}
                ${createRow(`7. ${o.other2Name}`, o.other2Vol)}
                ${createRow(`8. ${o.other3Name}`, o.other3Vol)}
                ${createRow(`9. ${o.other4Name}`, o.other4Vol)}
                <tr style="background:#eee; font-weight:800;">
                  <td class="text-right">Total Volume</td>
                  <td class="text-right">${o.totalVol}</td>
                </tr>
              </tbody>
            </table>
            <div class="footer-container">
              <div class="text-[14px] font-bold">
                <div>BW: ${o.bw} kg | Energy: ${o.productKcal} kcal</div>
                <div>Prepared: ${formatThaiDate(o.orderDate)}</div>
                <div class="text-[11px] italic mt-1 font-medium">Recorded By: ${o.recordedBy}</div>
              </div>
              <div class="text-right">
                <div class="rate-box inline-block mb-1">Rate: ${o.rate} ml/hr</div>
                <div class="exp-text uppercase">EXP: ${formatThaiDate(expDate)} 18:00</div>
              </div>
            </div>
          </div>
        `;
      }
      document.getElementById('pn-sticker-container').innerHTML = pnHTML;

      document.getElementById('bag-sticker-container').innerHTML = `
        <div class="sticker sticker-bag flex flex-col items-center justify-center text-center">
          <div style="font-size: 52px; font-weight: 900; line-height: 1;">${o.ward}</div>
          <div style="border-top: 4px solid #000; border-bottom: 4px solid #000; width: 100%; padding: 8px 0; margin: 8px 0;">
            <span style="font-size: 26px; font-weight: 900; display: block; line-height: 1.1;">${o.patientName}</span>
          </div>
          <div style="font-size: 22px; font-weight: 800; margin-bottom: 4px;">HN: ${o.hn}</div>
          <div style="font-size: 16px; font-weight: 700;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°: ${formatThaiDate(o.orderDate)}</div>
          <div style="font-size: 15px; font-weight: 800; color: #000; margin-top: 6px;">(‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡∏ï‡∏π‡πâ‡πÄ‡∏¢‡πá‡∏ô 2-8¬∞ C)</div>
        </div>
      `;
    }
  </script>
</body>
</html>
